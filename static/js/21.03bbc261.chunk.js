"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[21],{5021:function(e,t,n){n.r(t),n.d(t,{default:function(){return ge}});var r,a,o=n(9439),i=n(7313),c=n(8866),s=n(7829),l=n(4942),u=n(9099),d=n(9019),p=n(7592),h=n(2720),m=n(1479),f=n(9563),x=n(6417),b=function(e){var t=e.k,n=e.handleClick,r=e.disabled,a=void 0!==r&&r,o=e.className;return(0,x.jsx)(u.Z,{size:"large",variant:"contained",className:"".concat(C.button," ").concat(o),onClick:function(){return n(t)},disabled:a,disableRipple:!0,children:"b"===t?(0,x.jsx)(h.Z,{}):"c"===t?(0,x.jsx)(m.Z,{}):t})},g=function(e){var t=e.possibleChar,n=(0,i.useContext)(c.Z),r=n.numPadOrder,a=n.searchRoute,o=n.updateSearchRouteByButton;return(0,x.jsx)(d.ZP,{container:!0,spacing:0,children:r.split("").map((function(e){return(0,x.jsx)(d.ZP,{item:!0,xs:4,children:(0,x.jsx)(b,{k:e,handleClick:o,className:C.number,disabled:"b"===e&&""===a||!"bc".includes(e)&&!t.includes(e)||"c"===e&&""===a})},"input-"+e)}))})},v=function(e){var t=e.possibleChar,n=(0,i.useContext)(c.Z).updateSearchRouteByButton;return(0,x.jsx)(d.ZP,{container:!0,spacing:1,children:t.filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return(0,x.jsx)(d.ZP,{item:!0,xs:12,children:(0,x.jsx)(b,{k:e,handleClick:n,className:C.alphabet})},"input-"+e)}))})},Z=function(e){var t=e.boardTab,n=(0,i.useContext)(c.Z),r=n.searchRoute,a=n.db.routeList,o=T(r,a,t);return"prerendering"===navigator.userAgent?(0,x.jsx)(x.Fragment,{}):(0,x.jsxs)(y,{className:C.root,padding:0,children:[(0,x.jsx)(s.Z,{className:C.numPadContainer,padding:0,children:(0,x.jsx)(g,{possibleChar:o})}),(0,x.jsx)(s.Z,{className:C.alphabetPadContainer,padding:0,children:(0,x.jsx)(v,{possibleChar:o})})]})},j="inputpad",C={root:"".concat(j,"-boxContainer"),numPadContainer:"".concat(j,"-numPadContainer"),alphabetPadContainer:"".concat(j,"-alphabetPadContainer"),button:"".concat(j,"-button"),alphabet:"".concat(j,"-alphabet"),cancel:"".concat(j,"-cancel"),number:"".concat(j,"-number")},y=(0,p.ZP)(s.Z)((function(e){var t,n=e.theme;return t={},(0,l.Z)(t,"&.".concat(C.root),{zIndex:0,background:n.palette.background.default,display:"flex",flexDirection:"row",height:"248px",justifyContent:"space-around"}),(0,l.Z)(t,"& .".concat(C.numPadContainer),{width:"72%"}),(0,l.Z)(t,"& .".concat(C.alphabetPadContainer),{width:"20%",height:"246px",overflowX:"hidden",overflowY:"scroll"}),(0,l.Z)(t,"& .".concat(C.button),{background:n.palette.background.paper,color:n.palette.text.primary,width:"100%",fontSize:"1.8em",borderRadius:"unset","&:selected":{color:n.palette.text.primary},"&:hover":{backgroundColor:n.palette.background.paper}}),(0,l.Z)(t,"& .".concat(C.cancel),{fontSize:"0.9em"}),(0,l.Z)(t,"& .".concat(C.alphabet),{height:"52px"}),(0,l.Z)(t,"& .".concat(C.number),{height:"62px"}),t})),T=function(e,t,n){if(null==t)return[];var r={};return Object.entries(t).forEach((function(t){var a=(0,o.Z)(t,2),i=a[0],c=a[1];if(i.startsWith(e.toUpperCase())&&c.co.some((function(e){return f.nR[n].includes(e)}))){var s=i.slice(e.length,e.length+1);r[s]=isNaN(r[s])?1:r[s]+1}})),Object.entries(r).map((function(e){return e[0]})).filter((function(e){return"-"!==e}))},k=n(4511),w=n(5823),N=n(8485),R=n(5280),S=function(e){var t=e.boardTab,n=e.onChangeTab,r=(0,k.$)().t;return(0,x.jsx)(s.Z,{sx:P,children:(0,x.jsx)(N.Z,{value:t,onChange:function(e,t){return n(t,!0)},sx:I,children:Object.keys(f.nR).map((function(e){return(0,x.jsx)(R.Z,{label:r(e),value:e,disableRipple:!0},e)}))})})},I=(a={background:function(e){return e.palette.background.default},minHeight:"36px",overflow:"auto",maxWidth:"100%"},(0,l.Z)(a,"& .MuiTab-root",(r={py:0,minWidth:"85px",minHeight:"32px"},(0,l.Z)(r,"&.Mui-selected",{color:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}}),(0,l.Z)(r,"&.MuiButtonBase-root",{textTransform:"none"}),r)),(0,l.Z)(a,"& .MuiTabs-indicator",{backgroundColor:function(e){return"dark"===e.palette.mode?e.palette.primary.main:"black"}}),(0,l.Z)(a,"& .MuiTabs-scroller",{overflow:"auto !important"}),a),P={background:function(e){return"dark"===e.palette.mode?e.palette.background.default:"white"}},L=n(2547),D=n(275),B=n(2429),W=n(3165),z=n(4689),M=n(6912),O=n(1113),$=n(3135),H=n(7890),A=n(4183),F=n(3405),_=n(3428),U=n(9466),Y=function(e){var t=e.terminus,n=(0,k.$)(),r=n.t,a=n.i18n;return(0,x.jsx)(q,{children:(0,x.jsx)(O.Z,{component:"h3",variant:"body1",children:(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:X.fromToWrapper,children:[(0,x.jsx)("span",{className:X.fromToText,children:"".concat(r("\u5f80")," ")}),(0,x.jsx)("b",{children:(0,w.iF)(t.dest[a.language])})]}),(0,x.jsx)("div",{className:X.fromWrapper,children:(0,x.jsx)("span",{children:(0,w.iF)(t.orig[a.language])})})]})})})},E="routeTerminus",X={fromToWrapper:"".concat(E,"-fromToWrapper"),fromToText:"".concat(E,"-fromToText"),fromWrapper:"".concat(E,"-fromWrapper")},q=(0,p.ZP)("div")((function(e){var t,n=e.theme;return t={textAlign:"left"},(0,l.Z)(t,"& .".concat(X.fromToWrapper),{display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden"}),(0,l.Z)(t,"& .".concat(X.fromToText),{fontSize:"0.95rem",marginRight:n.spacing(.5)}),(0,l.Z)(t,"& .".concat(X.fromWrapper),{display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden",fontSize:"0.75rem"}),t})),G=n(9530),J=function(e){var t=e.route,n=(0,k.$)().t,r=t[0].split("-").slice(0,2),a=(0,o.Z)(r,2),i=a[0],c=a[1];return(0,x.jsxs)(V,{children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(G.Z,{routeNo:i}),parseInt(c,10)>=2&&(0,x.jsx)(O.Z,{variant:"caption",className:Q.specialTrip,children:n("\u7279\u5225\u73ed")})]}),(0,x.jsx)(O.Z,{component:"h4",variant:"caption",className:Q.company,children:t[1].co.map((function(e){return n(e)})).join("+")})]})},K="routeNoCompany",Q={company:"".concat(K,"-company"),specialTrip:"".concat(K,"-specialTrip")},V=(0,p.ZP)("div")((function(e){var t,n=e.theme;return t={},(0,l.Z)(t,"& .".concat(Q.company),{color:n.palette.text.secondary}),(0,l.Z)(t,"& .".concat(Q.specialTrip),{fontSize:"0.6rem",marginLeft:"8px"}),t})),ee=function(e){var t=e.route,n=e.handleClick,r=e.style,a=(0,k.$)().i18n;return(0,x.jsx)(U.rU,{onClick:n,to:"/".concat(a.language,"/route/").concat(t[0].toLowerCase()),style:r,children:(0,x.jsx)(ne,{variant:"outlined",square:!0,children:(0,x.jsx)(A.Z,{children:(0,x.jsxs)(F.Z,{className:te.cardContent,children:[(0,x.jsx)(J,{route:t}),(0,x.jsx)(Y,{terminus:t[1]})]})})},t[0])})},te={cardContent:"".concat("routeRow","-cardContent")},ne=(0,p.ZP)(_.Z)((function(e){var t=e.theme;return(0,l.Z)({border:"none"},"& .".concat(te.cardContent),{display:"grid",gridTemplateColumns:"25% 75%",padding:"0 ".concat(t.spacing(2)),alignItems:"center"})})),re=i.memo((function(e){var t=e.data,n=t.routeList,r=t.vibrateDuration,a=e.index,o=e.style,s=(0,k.$)().i18n,l=n[a],u=(0,H.s0)(),d=(0,i.useContext)(c.Z).addSearchHistory;return(0,x.jsx)(ee,{handleClick:function(e){e.preventDefault(),(0,w.tp)(r),d(l[0]),setTimeout((function(){u("/".concat(s.language,"/route/").concat(l[0].toLowerCase()))}),0)},route:l,style:o})}),W.wy),ae=(0,M.Z)((function(e,t){return{routeList:e,vibrateDuration:t}})),oe=(0,D.yP)((0,D.p6)(L.ZP)),ie=function(e){var t=e.boardTab,n=e.onChangeTab,r=(0,i.useContext)(c.Z),a=r.searchRoute,l=r.db,u=l.holidays,d=l.routeList,p=r.isRouteFilter,h=r.busSortOrder,m=r.vibrateDuration,b=(0,i.useMemo)((function(){return(0,$.HD)(u,new Date)}),[u]),g=(0,k.$)().t,v=(0,i.useMemo)((function(){var e=Object.entries(d).filter((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1],i=r.stops,c=r.co;return n.startsWith(a.toUpperCase())&&(null==i[c[0]]||i[c[0]].length>0)})).filter((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1].freq;return!p||(0,$.x4)(n,r,b)})).sort((function(e,t){return(0,w.nO)(e,t,f.Y$[h])}));return Object.entries(f.nR).map((function(t){var n=(0,o.Z)(t,2),r=(n[0],n[1]);return ae(e.filter((function(e){var t=(0,o.Z)(e,2);t[0];return t[1].co.some((function(e){return r.includes(e)}))})),m)}))}),[d,b,a,p,m,h]),Z=(0,i.useCallback)((function(e){var t=e.key,n=e.index;return(0,x.jsx)(i.Fragment,{children:v[n].routeList.length?(0,x.jsx)(z.Z,{children:function(e){var t=e.height,r=e.width;return(0,x.jsx)(W.t7,{height:.98*t,itemCount:v[n].routeList.length,itemSize:56,width:r,itemData:v[n],className:le.root,children:re})}}):(0,x.jsxs)(s.Z,{sx:de,children:[(0,x.jsx)(B.Z,{fontSize:"small"}),(0,x.jsxs)(s.Z,{children:[(0,x.jsxs)(O.Z,{variant:"h6",children:['"',a,'"']}),(0,x.jsx)(O.Z,{variant:"h6",children:g("route-search-no-result")})]})]})},t)}),[v,a,g]);return(0,i.useMemo)((function(){return(0,x.jsx)(x.Fragment,{children:"prerendering"===navigator.userAgent?(0,x.jsx)(ue,{className:le.prerenderList,children:v[0].routeList.map((function(e,t){return(0,x.jsx)(re,{data:v[0],index:t,style:null},"route-".concat(t))}))}):(0,x.jsx)(oe,{index:ce.indexOf(t),onChangeIndex:function(e){n(ce[e])},style:{flex:1,display:"flex"},containerStyle:{flex:1},slideCount:v.length,overscanSlideAfter:1,overscanSlideBefore:1,slideRenderer:Z,enableMouseEvents:!0})})}),[Z,v,n,t])},ce=["all","bus","minibus","lightRail","mtr"],se="routeBoard",le={root:"".concat(se,"-root"),prerenderList:"".concat(se,"-prerenderList"),noResult:"".concat(se,"-noResult")},ue=(0,p.ZP)("div")((function(e){e.theme;return(0,l.Z)({},"&.".concat(le.prerenderList),{height:"100%",overflowY:"scroll"})})),de=(0,l.Z)({height:"140px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},"& .MuiSvgIcon-root",{fontSize:"4rem",mr:2}),pe=n(1198),he=function(){var e=(0,i.useContext)(c.Z),t=e.db.routeList,n=e.vibrateDuration,r=e.routeSearchHistory,a=e.removeSearchHistoryByRouteId,s=(0,k.$)(),l=s.t,u=s.i18n,d=(0,H.s0)(),p=Object.entries(t).filter((function(e){var t=(0,o.Z)(e,1)[0];return r.includes(t.toUpperCase())}));return(0,x.jsxs)(xe,{children:[(0,x.jsx)("div",{className:fe.title,children:l("\u6700\u8fd1\u641c\u5c0b")}),(0,x.jsx)("div",{className:fe.historyItems,children:p.map((function(e,t){return(0,x.jsxs)("div",{className:fe.historyItem,children:[(0,x.jsx)("div",{className:fe.routeRow,children:(0,x.jsx)(ee,{handleClick:function(t){return function(e,t){e.preventDefault(),(0,w.tp)(n),setTimeout((function(){d("/".concat(u.language,"/route/").concat(t.toLowerCase()))}),0)}(t,e[0])},route:e,style:{}})}),(0,x.jsx)(pe.Z,{className:fe.closeIcon,onClick:function(t){return function(e,t){e.preventDefault(),a(t)}(t,e[0])}})]},t)}))})]})},me="routeSearchHistory",fe={title:"".concat(me,"-title"),historyItems:"".concat(me,"-historyItems"),historyItem:"".concat(me,"-historyItem"),routeRow:"".concat(me,"-routeRow"),closeIcon:"".concat(me,"-closeIcon")},xe=(0,p.ZP)("div")((function(e){var t,n=e.theme;return t={display:"grid",overflowY:"scroll",flexGrow:1,gridTemplateRows:"fit-content(0) auto"},(0,l.Z)(t,"& .".concat(fe.title),{padding:"0 ".concat(n.spacing(2)," ").concat(n.spacing(.5)),fontSize:"0.85rem"}),(0,l.Z)(t,"& .".concat(fe.historyItems),{}),(0,l.Z)(t,"& .".concat(fe.historyItem),{width:"100%",display:"grid",gridTemplateColumns:"minmax(0, 1fr) 32px",alignItems:"center",background:"dark"===n.palette.mode?n.palette.background.default:"white",borderBottom:"1px solid ".concat(n.palette.primary.contrastText)}),(0,l.Z)(t,"& .".concat(fe.closeIcon),{marginRight:n.spacing(2),cursor:"pointer"}),t})),be=function(e){var t=e.boardTab,n=e.setBoardTab,r=(0,i.useContext)(c.Z).AppTitle,a=(0,k.$)(),o=a.t,l=a.i18n;(0,i.useEffect)((function(){(0,w.ND)({title:o("\u641c\u5c0b")+" - "+o(r),description:o("route-board-page-description"),lang:l.language})}),[l.language]);var u=(0,i.useCallback)((function(e){n(e),localStorage.setItem("boardTab",e)}),[n]);return(0,x.jsxs)(s.Z,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[(0,x.jsx)(S,{boardTab:t,onChangeTab:u}),(0,x.jsx)(ie,{boardTab:t,onChangeTab:u})]})},ge=function(){var e,t=(0,i.useContext)(c.Z),n=t.searchRoute,r=t.routeSearchHistory,a=localStorage.getItem("boardTab"),s=(0,i.useState)("all"===(e=a)||"bus"===e||"minibus"===e||"lightRail"===e||"mtr"===e?a:"all"),l=(0,o.Z)(s,2),u=l[0],d=l[1],p=(0,i.useMemo)((function(){return 0===n.length&&Array.isArray(r)&&r.length>0}),[n,r]);return(0,x.jsxs)(x.Fragment,{children:[p?(0,x.jsx)(he,{}):(0,x.jsx)(be,{boardTab:u,setBoardTab:d}),(0,x.jsx)(Z,{boardTab:p?"all":u})]})}}}]);